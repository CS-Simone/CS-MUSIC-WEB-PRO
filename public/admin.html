<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>Admin - Upload</title>
</head>
<body>

<h1>Admin Panel - Upload Albums and Songs</h1>

<div id="album-section">
  <h2>Create Album</h2>
  <form id="album-form">
    <label>Album Name:</label>
    <input type="text" name="name" required><br>
    <label>Release Date:</label>
    <input type="date" name="releaseDate" required><br>
    <label>Cover Image:</label>
    <input type="file" name="coverFile" accept="image/*" required><br>
    <button type="submit">Create Album</button>
  </form>
</div>

<div id="song-section">
  <h2>Upload Song</h2>
  <form id="song-form">
    <label>Song Title:</label>
    <input type="text" name="title" required><br>
    <label>Authors (comma separated):</label>
    <input type="text" name="authors" required><br>
    <label>Album:</label>
    <select name="albumId" id="album-dropdown" required></select><br>
    <label>Release Date:</label>
    <input type="date" name="releaseDate" required><br>
    <label>Length (in seconds):</label>
    <input type="number" name="length" required><br>
    <label>Song File:</label>
    <input type="file" name="songFile" accept="audio/*" required><br>
    <button type="submit">Upload Song</button>
  </form>
</div>

<script>
  async function loadAlbumsForDropdown() {
    const response = await fetch('/api/albums');
    const albums = await response.json();
    const dropdown = document.getElementById('album-dropdown');
    
    // Clear existing options
    dropdown.innerHTML = '';

    albums.forEach(album => {
      const option = document.createElement('option');
      option.value = album._id;
      option.text = album.name;
      dropdown.add(option);
    });
  }

  document.getElementById('album-form').addEventListener('submit', async (event) => {
    event.preventDefault();
    const formData = new FormData(event.target);
    await fetch('/api/albums', {
      method: 'POST',
      body: formData
    });
    alert('Album created successfully!');
    loadAlbumsForDropdown(); // Refresh the dropdown after album creation
  });

  document.getElementById('song-form').addEventListener('submit', async (event) => {
    event.preventDefault();
    const formData = new FormData(event.target);
    await fetch('/api/upload', {
      method: 'POST',
      body: formData
    });
    alert('Song uploaded successfully!');
  });

  window.onload = function() {
    loadAlbumsForDropdown(); // Load albums on initial page load
  };
</script>

</body>
</html>
